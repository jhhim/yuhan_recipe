<!-- create.html -->
<!DOCTYPE html>
<html>

<head>
	<meta content="text/html; charset=euc-kr">
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Expires" content="0">
	<title>모두의레시피</title>
	<style type="text/css">
	</style>
	<script src="/src/main/resources/static/js/userRecipe.js"></script>
	<script src="https://kit.fontawesome.com/2636adf573.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" type="text/css" th:href="@{/../css/createRecipe.css}" />
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
	<script>
		function handleClick(event) {
			event.preventDefault(); // 폼 제출 막기
			// 원하는 작업 수행
			console.log("Button clicked, but form submission prevented.");
		}
	</script>
</head>

<body>

	<div class="body_wrapper">
		<div class="body_content">
			<div class="menubar"></div>
			<span class="menu4"><a href="recipe">분류</a></span>
			<span class="menu3"><a href="rank">랭크</a></span>
			<span class="menu2"><a href="board">게시판</a></span>
			<span class="menu1"><a href="rank">랭킹</a></span>
			<span><a class="mainicon" href="/">모두의레시피</a></span>


			<!-- 마이페이지 주소 입력 -->
			<div class="usericon"><a href="/mypage"><i class="fa-solid fa-user"></i></a></div>
			<!-- 로그아웃 주소 입력 -->
			<div class="logout_icon"><a href="/logout"><i class="fa-solid fa-right-from-bracket"></i></a></div>
			<div class="searchbar">
				<div class="searchradius">
					<form action="" method=""> <!-- 검색창 주소 입력 -->
						<input type="text" class="search_txt">
						<button type="submit" class="search_btn">
							<span class="searchicon">
								<i class="fa-solid fa-magnifying-glass"></i>
							</span>
						</button>
					</form>
				</div>
			</div>
			<!-- 여기부터 body에 추가할 코드 입력 -->

			<div class="slide_wrapper">
				<form action="/createRecipe" method="post" enctype="multipart/form-data">
					<div class=e10_2>
						<span class="e16_84">레시피</span>
						<div class=e10_3>
							<span class="e10_7">레시피제목</span>
							<span class="e10_8">요리 소개</span>
							<span class="e10_10"><textarea name="title"></textarea></span>
							<span class="e10_11"><textarea name="recipesubtxt"></textarea></span>
						</div>
						<div class=e10_4>
							<span class="e10_15">
								<input multiple type="file" id="file" name="file" style="display: none;">
								<button id="uploadButton" name="uploadButton" onclick="handleClick(event)">
									<div id="preview" name="preview" width="400px" height="400px">
										<img src="/img/대표이미지.PNG" width="400px" height="400px">
									</div>
								</button>
							</span>
						</div>
						<div class=e10_5>
							<span class="e10_9">카테고리</span>
							<span class="e10_13">
								<select id="categoryName" name="category_name">
									<option value="파티">파티용</option>
									<option value="혼밥">혼밥용</option>
									<option value="피크닉">피크닉용</option>
									<option value="가정">가정용</option>
									<option value="디저트">디저트용</option>
									<option value="야식안주">야식/안주용</option>
								</select>
								<input type="submit" value="게시">
							</span>
						</div>
					</div>
					<div class="e10_2_1">
						<span class="e16_84">재료</span>
						<div id="container">
							<button id="addButton" onclick="handleClick(event)" width="150px" height="50px"
								cursor="pointer">재료 추가</button>
							<div class='textRow' id="t1">
								<input type="text" class='text1' placeholder="예 ) 간 장">
								<input type="text" class='text1' placeholder="예 ) 한 큰 술">
								<input type="button" id="removebutton" class="remove-button" value="삭제">
							</div>
							<div class='textRow' id="t2">
								<input type="text" class='text1' placeholder="예 ) 우 유">
								<input type="text" class='text1' placeholder="예 ) 5 0 0 ml">
								<input type="button" id="removebutton1" class="remove-button" value="삭제">
							</div>
							<div class='textRow' id="t3">
								<input type="text" class='text1' placeholder="예 ) 감 자">
								<input type="text" class='text1' placeholder="예 ) 3 개">
								<input type="button" id="removebutton2" class="remove-button" value="삭제">
							</div>
						</div>


						<span class="e12_5">재료가 남거나 부족하지 않도록 정확한 계량정보를 적어주세요.</span>
					</div>
					<div class="e10_2_2">
						<span class="e16_84">요리순서</span>
						<span class="e12_5">요리의 맛이 좌우될 수 있는 중요한 부분은 빠짐없이 적어주세요.</span>
						<div id="container1">
							<button id="addButton1" onclick="handleClick(event)" width="150px" height="50px"
								cursor="pointer">스텝 추가</button>
							<div class='textRow1' id="r1">
								<label class="step">STEP 1</label><br>
								<textarea class='text2' placeholder='예 ) 김치 반 포기를 잘게 썰어주세요.'></textarea>
								<input multiple type="file" id="file1" name="file" style="display: none;">
								<button id="uploadButton1" name="uploadButton1" onclick="handleClick(event); handleUploadClick(1)">
									<div id="preview1" name="preview1">
										<img src="/img/대표이미지.PNG" width="200px" height="200px">
									</div>
								</button>
								<input type="button" class="remove-button1" onclick="removeStep1('r1')" value="삭제"><br>
								<img src="/img/carrot.png" class="carrot">
								<input type="text" class="text3"
									placeholder="재료에 대해 적어주세요! 예 ) 감자 1개, 소금 2큰술, 물 2컵"><br>
								<img src="/img/냄비.png" class="carrot">
								<input type="text" class="text3" placeholder="재료도구에 대해 적어주세요! 예 ) 냄비, 프라이팬, 국자"><br>
								<img src="/img/불.png" class="carrot">
								<input type="text" class="text3"
									placeholder="불 세기나 도구 사용시간에 대해 적어주세요! 예 ) 약불, 전자레인지 2분"><br>
								<img src="/img/전구.png" class="carrot1">
								<textarea class="text4" placeholder="팁이 있다면 적어주세요! 예 ) 삶은 감자를 2분 정도 식혀주세요"></textarea>
							</div>
						</div>
					</div>
				</form>
			</div>


			<script th:src="@{/../js/main.js}"></script>

		</div>
		<div class="footer">
			<div class="footer_comment">@Yuhan University Group 3's Project</div>
		</div>
		<script>
			const addButton = document.getElementById('addButton');
			const container = document.getElementById('container');
			const removebutton1 = document.getElementById('removebutton');
			const removebutton2 = document.getElementById('removebutton1');
			const removebutton3 = document.getElementById('removebutton2');
			const t1 = document.getElementById('t1');
			const t2 = document.getElementById('t2');
			const t3 = document.getElementById('t3');
			const e10_2_1d = document.querySelector('.e10_2_1');
			const e10_2_2d = document.querySelector('.e10_2_2');
			const tr = document.querySelector('text-row');
			let itemCount = 0;
			const items = ['예 ) 감 자', '예 ) 소 금', '예 ) 돼 지 고 기', '예 ) 간 장', '예 ) 우 유'];
			const info = ['예 ) 3 개', '예 ) 1 T', '예 ) 3 0 0 g', '예 ) 한 큰 술', '예 ) 5 0 0 ml'];

			addButton.addEventListener('click', () => {
				itemCount++;
				if (itemCount == 5) {
					itemCount = 0;
				}

				const textRow = document.createElement('div');
				textRow.classList.add('text-row');

				const text1 = document.createElement('input');
				text1.classList.add('text');
				text1.textContent = '';
				text1.style.width = '200px';
				text1.style.height = '50px';
				text1.placeholder = items[itemCount];
				textRow.appendChild(text1);

				const text2 = document.createElement('input');
				text2.classList.add('text');
				text2.textContent = '';
				text2.style.width = '200px';
				text2.style.height = '50px';
				text2.placeholder = info[itemCount];
				textRow.appendChild(text2);

				const removeButton = document.createElement('button');
				removeButton.classList.add('remove-button');
				removeButton.textContent = '삭제';
				removeButton.addEventListener('click', () => {
					container.removeChild(textRow);
					adjustContainerHeight();
				});
				textRow.appendChild(removeButton);


				container.appendChild(textRow);
				adjustContainerHeight();
			});
			removebutton1.addEventListener('click', () => {
				container.removeChild(t1);
				adjustContainerHeight();
			});
			removebutton2.addEventListener('click', () => {
				container.removeChild(t2);
				adjustContainerHeight();
			}); removebutton3.addEventListener('click', () => {
				container.removeChild(t3);
				adjustContainerHeight();
			});

			function adjustContainerHeight() {
				const e10_2_1dbt = e10_2_1d.getBoundingClientRect();
				const e10_2_1dh = e10_2_1dbt.height;
				const containerHeight = container.clientHeight;
				e10_2_1d.style.height = containerHeight + 'px';
				const conlastch = container.lastElementChild;
				const lastgb = conlastch.getBoundingClientRect();
				const lastbt = lastgb.bottom;



				const e10_2_2dbt = e10_2_2d.getBoundingClientRect();

				const bt = e10_2_1dbt.bottom;



				e10_2_2d.style.top = e10_2_1dh + 950 + 'px';

			}

			//요리스텝 스크립트
			let stepCount = 1;
			let steptxtindex = 1;
			const steptext = ['예 ) 다 볶았으면 접시에 옮겨 담고 마지막으로 참깨가루를 뿌려주세요.',
				'예 ) 김치 반 포기를 잘게 썰어주세요.',
				'예 ) 양파, 대파을 썰고, 마늘은 다져주세요.',
				'예 ) 프라이팬에 식용유를 2스푼정도 두르고 중불로 달궈주세요.',
				'예 ) 김치와 양파를 넣고 5분정도 볶아주세요.',
				'예 ) 볶았으면 밥 한 공기와, 다시다 1큰술, 물엿 2큰술을 넣고 5분정도 볶아주세요.',
				'예 ) 볶은 뒤 참기름을 반큰술 넣고 1분만 볶아주세요.']

			const addButton1 = document.getElementById("addButton1");
			const container1 = document.getElementById("container1");

			addButton1.addEventListener("click", addStep);

			function addStep() {
				stepCount++;
				steptxtindex++;
				if (steptxtindex == 7) {
					steptxtindex = 0;
				}

				const newStep = document.createElement("div");
				newStep.className = "textRow1";
				newStep.id = "r" + stepCount;

				newStep.innerHTML = `
                <label class="step">STEP ${stepCount}</label><br>
								<textarea class='text2' placeholder="${steptext[steptxtindex]}"></textarea>
								<input multiple type="file" id="file${stepCount}" name="file" style="display: none;">
								<button id="uploadButton${stepCount}" name="uploadButton1" onclick="handleClick(event); handleUploadClick(${stepCount})">
									<div id="preview${stepCount}" name="preview1">
										<img src="/img/대표이미지.PNG" width="200px" height="200px">
										</div>
								</button>
								<input type="button" class="remove-button1" value="삭제" onclick="removeStep1('r${stepCount}')"><br>
								<img src="/img/carrot.png" class="carrot">
								<input type="text" class="text3" placeholder="재료에 대해 적어주세요! 예 ) 감자 1개, 소금 2큰술, 물 2컵"><br>
								<img src="/img/냄비.png" class="carrot">
								<input type="text" class="text3" placeholder="재료도구에 대해 적어주세요! 예 ) 냄비, 프라이팬, 국자"><br>
								<img src="/img/불.png" class="carrot">
								<input type="text" class="text3" placeholder="불 세기나 도구 사용시간에 대해 적어주세요! 예 ) 약불, 전자레인지 2분"><br>
								<img src="/img/전구.png" class="carrot1">
								<textarea class="text4" placeholder="팁이 있다면 적어주세요! 예 ) 삶은 감자를 2분 정도 식혀주세요"></textarea>
            `;

				container1.appendChild(newStep);
			}

			function removeStep1(stepId) {
				const stepToRemove = document.getElementById(stepId);
				if (stepToRemove) {
					stepToRemove.remove();
					stepCount--;
					// 중간의 스텝이 제거되면 다시 스텝 숫자를 정렬
					reorganizeStepLabels();
				}
			}


			function reorganizeStepLabels() {
				const stepLabels = document.querySelectorAll(".step");
				stepLabels.forEach((label, index) => {
					label.textContent = `STEP ${index + 1}`;
				});
			}

		
			function handleUploadClick(stepNumber) {
            const imageInput1 = document.getElementById(`file${stepNumber}`);
            const uploadButton1 = document.getElementById(`uploadButton${stepNumber}`);
            const preview1 = document.getElementById(`preview${stepNumber}`);
            
            uploadButton1.addEventListener('click', () => {
                imageInput1.click();
            });

            imageInput1.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        const image1 = new Image();
                        image1.src = e.target.result;
                        image1.style.maxWidth = '100%';
                        image1.style.maxHeight = '100%';
                        preview1.innerHTML = '';
                        preview1.appendChild(image1);
                    };
                    
                    reader.readAsDataURL(file);
                }
            });

            // 업로드 버튼을 클릭하여 이미지 선택 창을 띄우기
            imageInput.click();
        }
        
        const imageInput = document.getElementById('file');
									const uploadButton = document.getElementById('uploadButton');
									const preview = document.getElementById('preview');

									uploadButton.addEventListener('click', () => {
										imageInput.click();
									});

									imageInput.addEventListener('change', (event) => {
										let stepCount1 = stepCount;
										if(stepCount == 1){
											stepCount1 = 0;
										}
										const file = event.target.files[stepCount1];
										if (file) {
											const reader = new FileReader();

											reader.onload = (e) => {
												const image = new Image();
												image.src = e.target.result;
												image.style.maxWidth = '100%';
												image.style.maxHeight = '100%';
												preview.innerHTML = '';
												preview.appendChild(image);
											};

											reader.readAsDataURL(file);
										}
									});
		</script>
</body>

</html>